<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction Receipt</title>
    <link rel="stylesheet" th:href="@{/css/general_styles.css}">
    <link rel="stylesheet" th:href="@{/css/receiptpage_styles.css}">
</head>
<body>

<header>
    <h1 class="webapp-title">Virtual Vending Machine Webapp</h1>
</header>

<h2 class="receipt-heading">Transaction Receipt</h2>

<!-- Show error message if transaction is missing -->
<p th:if="${error}" class="error-text">
    Error: <span th:text="${error}"></span>
</p>

<!-- Receipt Box Shown if No Errors -->
<div class="receipt-box" th:if="${transaction}">
    <p><strong>Transaction ID:</strong> <span th:text="${transaction.id}"></span></p>
    <p><strong>Date:</strong> <span th:text="${#dates.format(transaction.transactionDate, 'dd/MM/yyyy')}"></span></p>
    <p><strong>Time:</strong> <span th:text="${#dates.format(transaction.transactionDate, 'HH:mm:ss')}"></span></p>

    <div class="receipt-divider">----------------------------------------</div>

    <h3>Purchased Products:</h3>
    <ul>
        <li th:each="transactionProduct : ${transaction.transactionProducts}">
        <span th:text="${transactionProduct.quantity} + ' x ' + ${productNames[transactionProduct.productId]} +
               ' (£' + ${#numbers.formatDecimal(productPrices[transactionProduct.productId], 1, 2)} + ' each) - £' +
               ${#numbers.formatDecimal(transactionProduct.quantity * productPrices[transactionProduct.productId], 1, 2)}">
        </span>
        </li>
    </ul>


    <div class="receipt-divider">----------------------------------------</div>

    <p><strong>Total Cost:</strong> £<span th:text="${#numbers.formatDecimal(transaction.totalCost, 1, 2)}"></span></p>
    <p><strong>Payment Received:</strong> £<span th:text="${#numbers.formatDecimal(transaction.paymentReceived, 1, 2)}"></span></p>
    <p><strong>Change Given:</strong> £<span th:text="${#numbers.formatDecimal(transaction.changeGiven, 1, 2)}"></span></p>
</div>

<!-- Receipt Buttons -->
<div class="receipt-buttons">
    <button class="home-btn" onclick="exitToHome()">Return to Home</button>
    <button class="download-btn" onclick="downloadReceipt()"> Download Receipt
        <span class="download-icon">⬇</span>
    </button>
</div>

<script th:src="@{/scripts/payment_script.js}"></script>
</body>
</html>
